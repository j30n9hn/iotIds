# /opt/snort3/rules/hub.rules.bak
#drop icmp any any -> any any (msg:"Custom: ICMP Echo Request (ping) detected"; itype:8; sid:1000001; rev:1; classtype:misc-activity; priority:3;)

# 1. drop to port scanning(nmap)
drop tcp 10.10.0.10 any -> $HUB any (
    msg:"PORTSCAN: TCP SYN scan on hub";
    flags:S; flow:stateless;
    detection_filter:track by_src, count 20, seconds 3;
    sid:1000101; rev:1;
)

# 2
drop tcp 10.10.0.10 any -> $HUB any (
    msg:"PORTSCAN: TCP FIN scan on hub";
    flags:F; flow:stateless;
    detection_filter:track by_src, count 15, seconds 3;
    sid:1000102; rev:1;
)

# 3
drop tcp 10.10.0.10 any -> $HUB any (
    msg:"PORTSCAN: TCP NULL scan on hub";
    flags:0; flow:stateless;
    detection_filter:track by_src, count 15, seconds 3;
    sid:1000103; rev:1;
)

# 4
drop tcp 10.10.0.10 any -> $HUB any (
    msg:"PORTSCAN: TCP XMAS scan on hub";
    flags:FPU; flow:stateless;
    detection_filter:track by_src, count 15, seconds 3;
    sid:1000104; rev:1;
)

# 5
drop udp 10.10.0.10 any -> $HUB any (
    msg:"PORTSCAN: UDP scan on hub";
    flow:stateless;
    detection_filter:track by_src, count 20, seconds 5;
    sid:1000105; rev:1;
)

# 6
drop icmp 10.10.0.10 any -> $HUB any (
    msg:"PORTSCAN: ICMP echo sweep towards hub";
    itype:8;
    detection_filter:track by_src, count 10, seconds 3;
    sid:1000106; rev:1;
)

# 7
drop tcp 10.10.0.10 any -> $HUB [80,8080] (
    msg:"PORTSCAN: Nmap HTTP service probe";
    flow:to_server,established;
    content:"User-Agent|3a| Nmap"; http_header;
    sid:1000107; rev:1;
)

# 8 drop attemp garafana
drop tcp any any -> $HUB 3000 (
    msg:"GRAFANA BLOCK: Port scan detected to Grafana";
    flags:S;
    threshold:type both, track by_src, count 10, seconds 10;
    sid:1000108; rev:1;
)

# 9
drop tcp any any -> $HUB 3000 (
    msg:"GRAFANA BLOCK: Login brute force threshold exceeded";
    content:"POST"; http_method; content:"/login"; http_uri;
    threshold:type both, track by_src, count 20, seconds 60;
    sid:1000109; rev:1;
)

# 10
drop http any any -> $HUB 3000 (
    msg:"GRAFANA BLOCK: CVE-2021-43798 exploit attempt";
    content:"/public/plugins/"; http_uri;
    content:"../"; http_uri;
    content:"etc/passwd"; http_uri;
    sid:1000110; rev:1;
)

# 11
drop http any any -> $HUB 3000 (
   msg:"GRAFANA BLOCK: Unauthorized API access attempt";
   content:"/api/"; http_uri;
   sid:1000111; rev:1;
)


# 12
drop tcp any any -> $HUB 3000 (
    msg:"GRAFANA BLOCK: DoS prevention - excessive traffic";
    threshold:type threshold, track by_src, count 200, seconds 5;
    sid:1000112; rev:1;
)

# 13
drop http any any -> $HUB 3000 (
    msg:"GRAFANA Attack: Illegal config access attempt";
    content:"/conf/"; http_uri;
    sid:1000113; rev:1;
)

# 14 drop attemp door open
drop http 10.10.0.10 any -> $HUB 80 (
    msg:"IOT: Unauthorized door lock and unlock attempt";
    http_uri; content:"/door/control"; nocase;
    sid:1000114; rev:1;
)

# 15
drop http 10.10.0.10 any -> $HUB 80 (
    msg:"IOT: Unauthorized door unlock command";
    http_client_body; content:"\"cmd\":\"open\""; nocase;
    sid:1000115; rev:1;
)

# 16 drop curtain control attemp
drop http 10.10.0.10 any -> $HUB 80 (
    msg:"IOT: Malicious curtain control attempt";
    http_uri; content:"/curtain/control"; nocase;
    sid:1000116; rev:1;
)

# 17 drop melicious attemp to control IoT hub
drop http 10.10.0.10 any -> $HUB 80 (
    msg:"IOT: Suspicious HTTP method on IoT hub";
    http_method; content:"DELETE"; nocase;
    sid:1000117; rev:1;
)

# 18 drop directory traversal attemp
drop http 10.10.0.10 any -> $HUB 80 (
    msg:"IOT: Directory traversal attempt";
    http_uri; content:"../";
    sid:1000118; rev:1;
)

# 19 drop IoT hub SQL Injection attemp
drop http 10.10.0.10 any -> $HUB 80 (
    msg:"IOT: SQL Injection attempt to IoT hub";
    content:"' OR '1'='1"; nocase;
    sid:1000119; rev:1;
)

# 20 drop IoT hun Dos attack attemp
drop tcp 10.10.0.10 any -> $HUB 80 (
    msg:"DOS: HTTP request flood";
    detection_filter:track by_src, count 50, seconds 3;
    sid:1000120; rev:1;
)

# 21 drop melicious Mqtt
alert tcp 10.10.0.10 any -> $HUB 1883 (
    msg:"MQTT: suspicious PUBLISH to IoT devices";
    content:"PUBLISH";
    sid:1000121; rev:1;
)

# 22 drop unnecesery service
drop tcp 10.10.0.10 any -> $HUB [22,23,445] (
    msg:"IOT: Access to unauthorized internal service";
    sid:1000122; rev:1;
)
